var content=function(){"use strict";var C=Object.defineProperty;var L=(d,a,o)=>a in d?C(d,a,{enumerable:!0,configurable:!0,writable:!0,value:o}):d[a]=o;var l=(d,a,o)=>L(d,typeof a!="symbol"?a+"":a,o);var E,I;function d(n){return n}const o=(I=(E=globalThis.browser)==null?void 0:E.runtime)!=null&&I.id?globalThis.browser:globalThis.chrome,p={matches:["*://*.xiaohongshu.com/*"],main(){const n=new MutationObserver(e=>{if(e.some(s=>Array.from(s.addedNodes).some(c=>c.nodeName==="IFRAME")))return;const i=document.querySelectorAll(".note-item");i.length>0&&(console.log("获取到的元素",i),t(i),n.disconnect())});n.observe(document.body,{childList:!0,subtree:!0,attributes:!1,characterData:!1});function t(e){var r,i,s,c,h;for(let b of e){const y=(i=(r=b.querySelector(".title"))==null?void 0:r.textContent)==null?void 0:i.trim(),F=(c=(s=b.querySelector(".name"))==null?void 0:s.textContent)==null?void 0:c.trim(),M=(h=b.querySelector(".cover"))==null?void 0:h.href;o.runtime.sendMessage({type:"NOTE_DETAILS",data:{title:y,nickName:F,noteLink:M}})}}console.log("脚本加载完毕")}};function m(n,...t){}const T={debug:(...n)=>m(console.debug,...n),log:(...n)=>m(console.log,...n),warn:(...n)=>m(console.warn,...n),error:(...n)=>m(console.error,...n)},f=class f extends Event{constructor(t,e){super(f.EVENT_NAME,{}),this.newUrl=t,this.oldUrl=e}};l(f,"EVENT_NAME",S("wxt:locationchange"));let v=f;function S(n){var t;return`${(t=o==null?void 0:o.runtime)==null?void 0:t.id}:content:${n}`}function A(n){let t,e;return{run(){t==null&&(e=new URL(location.href),t=n.setInterval(()=>{let r=new URL(location.href);r.href!==e.href&&(window.dispatchEvent(new v(r,e)),e=r)},1e3))}}}const u=class u{constructor(t,e){l(this,"isTopFrame",window.self===window.top);l(this,"abortController");l(this,"locationWatcher",A(this));l(this,"receivedMessageIds",new Set);this.contentScriptName=t,this.options=e,this.abortController=new AbortController,this.isTopFrame?(this.listenForNewerScripts({ignoreFirstEvent:!0}),this.stopOldScripts()):this.listenForNewerScripts()}get signal(){return this.abortController.signal}abort(t){return this.abortController.abort(t)}get isInvalid(){return o.runtime.id==null&&this.notifyInvalidated(),this.signal.aborted}get isValid(){return!this.isInvalid}onInvalidated(t){return this.signal.addEventListener("abort",t),()=>this.signal.removeEventListener("abort",t)}block(){return new Promise(()=>{})}setInterval(t,e){const r=setInterval(()=>{this.isValid&&t()},e);return this.onInvalidated(()=>clearInterval(r)),r}setTimeout(t,e){const r=setTimeout(()=>{this.isValid&&t()},e);return this.onInvalidated(()=>clearTimeout(r)),r}requestAnimationFrame(t){const e=requestAnimationFrame((...r)=>{this.isValid&&t(...r)});return this.onInvalidated(()=>cancelAnimationFrame(e)),e}requestIdleCallback(t,e){const r=requestIdleCallback((...i)=>{this.signal.aborted||t(...i)},e);return this.onInvalidated(()=>cancelIdleCallback(r)),r}addEventListener(t,e,r,i){var s;e==="wxt:locationchange"&&this.isValid&&this.locationWatcher.run(),(s=t.addEventListener)==null||s.call(t,e.startsWith("wxt:")?S(e):e,r,{...i,signal:this.signal})}notifyInvalidated(){this.abort("Content script context invalidated"),T.debug(`Content script "${this.contentScriptName}" context invalidated`)}stopOldScripts(){window.postMessage({type:u.SCRIPT_STARTED_MESSAGE_TYPE,contentScriptName:this.contentScriptName,messageId:Math.random().toString(36).slice(2)},"*")}verifyScriptStartedEvent(t){var s,c,h;const e=((s=t.data)==null?void 0:s.type)===u.SCRIPT_STARTED_MESSAGE_TYPE,r=((c=t.data)==null?void 0:c.contentScriptName)===this.contentScriptName,i=!this.receivedMessageIds.has((h=t.data)==null?void 0:h.messageId);return e&&r&&i}listenForNewerScripts(t){let e=!0;const r=i=>{if(this.verifyScriptStartedEvent(i)){this.receivedMessageIds.add(i.data.messageId);const s=e;if(e=!1,s&&(t!=null&&t.ignoreFirstEvent))return;this.notifyInvalidated()}};addEventListener("message",r),this.onInvalidated(()=>removeEventListener("message",r))}};l(u,"SCRIPT_STARTED_MESSAGE_TYPE",S("wxt:content-script-started"));let w=u;function q(){}function g(n,...t){}const N={debug:(...n)=>g(console.debug,...n),log:(...n)=>g(console.log,...n),warn:(...n)=>g(console.warn,...n),error:(...n)=>g(console.error,...n)};return(async()=>{try{const{main:n,...t}=p,e=new w("content",t);return await n(e)}catch(n){throw N.error('The content script "content" crashed on startup!',n),n}})()}();
content;
