var content=function(){"use strict";var k=Object.defineProperty;var P=(f,u,w)=>u in f?k(f,u,{enumerable:!0,configurable:!0,writable:!0,value:w}):f[u]=w;var h=(f,u,w)=>P(f,typeof u!="symbol"?u+"":u,w);var q,F;function f(e){return e}const u={matches:["*://*.xiaohongshu.com/*"],main(){const e=[],t=new MutationObserver(i=>{if(i.some(m=>Array.from(m.addedNodes).some(c=>c.nodeName==="IFRAME")))return;const r=document.querySelectorAll(".note-item");r.length>0&&(console.log("获取到的元素",r),n(r),t.disconnect())});t.observe(document.body,{childList:!0,subtree:!0,attributes:!1,characterData:!1});async function n(i){var s,r,m,c,a;for(let l of i){const g=(r=(s=l.querySelector(".title"))==null?void 0:s.textContent)==null?void 0:r.trim(),C=(c=(m=l.querySelector(".name"))==null?void 0:m.textContent)==null?void 0:c.trim(),S=(a=l.querySelector(".cover"))==null?void 0:a.href;if(S){const p=await o(S);e.push({title:g,nickName:C,noteLink:S,...p})}}console.log("处理完成",e)}function o(i){return new Promise(s=>{const r=document.createElement("iframe");r.style.display="none",r.addEventListener("load",()=>{const a=r.contentDocument;a!=null&&a.URL.includes("login")&&(r.srcdoc=`<script>location.href="${i}"<\/script>`)}),document.body.appendChild(r),console.log("iframe",r);const m=setTimeout(()=>{c(),s(null)},1e4),c=()=>{clearTimeout(m),document.body.removeChild(r)};r.onload=function(){var a;try{const l=r.contentDocument||((a=r.contentWindow)==null?void 0:a.document);if(!l)return c(),s(null);const g=d(l);c(),s(g)}catch(l){console.log("iframe内容访问受限:",l),c(),s(null)}},r.src=i})}function d(i){var s,r,m,c,a,l,g,C,S;try{const p=(m=(r=(s=i.querySelector(".like-wrapper"))==null?void 0:s.querySelector(".count"))==null?void 0:r.textContent)==null?void 0:m.trim(),M=(l=(a=(c=i.querySelector(".collect-wrapper"))==null?void 0:c.querySelector(".count"))==null?void 0:a.textContent)==null?void 0:l.trim(),x=(S=(C=(g=i.querySelector(".chat-wrapper"))==null?void 0:g.querySelector(".count"))==null?void 0:C.textContent)==null?void 0:S.trim();return{likeCount:p==="点赞"?0:p,collectCount:M==="收藏"?0:M,commentCount:x==="评论"?0:x}}catch(p){return console.error("解析内容失败:",p),null}}console.log("脚本加载完毕")}},b=(F=(q=globalThis.browser)==null?void 0:q.runtime)!=null&&F.id?globalThis.browser:globalThis.chrome;function E(e,...t){}const L={debug:(...e)=>E(console.debug,...e),log:(...e)=>E(console.log,...e),warn:(...e)=>E(console.warn,...e),error:(...e)=>E(console.error,...e)},y=class y extends Event{constructor(t,n){super(y.EVENT_NAME,{}),this.newUrl=t,this.oldUrl=n}};h(y,"EVENT_NAME",N("wxt:locationchange"));let T=y;function N(e){var t;return`${(t=b==null?void 0:b.runtime)==null?void 0:t.id}:content:${e}`}function R(e){let t,n;return{run(){t==null&&(n=new URL(location.href),t=e.setInterval(()=>{let o=new URL(location.href);o.href!==n.href&&(window.dispatchEvent(new T(o,n)),n=o)},1e3))}}}const v=class v{constructor(t,n){h(this,"isTopFrame",window.self===window.top);h(this,"abortController");h(this,"locationWatcher",R(this));h(this,"receivedMessageIds",new Set);this.contentScriptName=t,this.options=n,this.abortController=new AbortController,this.isTopFrame?(this.listenForNewerScripts({ignoreFirstEvent:!0}),this.stopOldScripts()):this.listenForNewerScripts()}get signal(){return this.abortController.signal}abort(t){return this.abortController.abort(t)}get isInvalid(){return b.runtime.id==null&&this.notifyInvalidated(),this.signal.aborted}get isValid(){return!this.isInvalid}onInvalidated(t){return this.signal.addEventListener("abort",t),()=>this.signal.removeEventListener("abort",t)}block(){return new Promise(()=>{})}setInterval(t,n){const o=setInterval(()=>{this.isValid&&t()},n);return this.onInvalidated(()=>clearInterval(o)),o}setTimeout(t,n){const o=setTimeout(()=>{this.isValid&&t()},n);return this.onInvalidated(()=>clearTimeout(o)),o}requestAnimationFrame(t){const n=requestAnimationFrame((...o)=>{this.isValid&&t(...o)});return this.onInvalidated(()=>cancelAnimationFrame(n)),n}requestIdleCallback(t,n){const o=requestIdleCallback((...d)=>{this.signal.aborted||t(...d)},n);return this.onInvalidated(()=>cancelIdleCallback(o)),o}addEventListener(t,n,o,d){var i;n==="wxt:locationchange"&&this.isValid&&this.locationWatcher.run(),(i=t.addEventListener)==null||i.call(t,n.startsWith("wxt:")?N(n):n,o,{...d,signal:this.signal})}notifyInvalidated(){this.abort("Content script context invalidated"),L.debug(`Content script "${this.contentScriptName}" context invalidated`)}stopOldScripts(){window.postMessage({type:v.SCRIPT_STARTED_MESSAGE_TYPE,contentScriptName:this.contentScriptName,messageId:Math.random().toString(36).slice(2)},"*")}verifyScriptStartedEvent(t){var i,s,r;const n=((i=t.data)==null?void 0:i.type)===v.SCRIPT_STARTED_MESSAGE_TYPE,o=((s=t.data)==null?void 0:s.contentScriptName)===this.contentScriptName,d=!this.receivedMessageIds.has((r=t.data)==null?void 0:r.messageId);return n&&o&&d}listenForNewerScripts(t){let n=!0;const o=d=>{if(this.verifyScriptStartedEvent(d)){this.receivedMessageIds.add(d.data.messageId);const i=n;if(n=!1,i&&(t!=null&&t.ignoreFirstEvent))return;this.notifyInvalidated()}};addEventListener("message",o),this.onInvalidated(()=>removeEventListener("message",o))}};h(v,"SCRIPT_STARTED_MESSAGE_TYPE",N("wxt:content-script-started"));let A=v;function U(){}function I(e,...t){}const $={debug:(...e)=>I(console.debug,...e),log:(...e)=>I(console.log,...e),warn:(...e)=>I(console.warn,...e),error:(...e)=>I(console.error,...e)};return(async()=>{try{const{main:e,...t}=u,n=new A("content",t);return await e(n)}catch(e){throw $.error('The content script "content" crashed on startup!',e),e}})()}();
content;
